---
title: "Linkedin Deliverable 3"
author: "Jonathan Cheon"
date: "10/7/2019"
output:
  html_document: default
  pdf_document: default
---

# Final Deliverable 
In this study, I was able to look at various Linkedin datasets. Initially, I wanted to discover how beauty would impact a person's career or salary. Due to complications, my research questions have changed or turned different directions. 

This report will improve previous deliverables and provide a final suggestion. 


### Importing libraries and previous files 
```{r echo = FALSE}
include <- function(library_name){
  if( !(library_name %in% installed.packages()) )
    install.packages(library_name)
  suppressMessages(library(library_name, character.only=TRUE))
}

include("tidyverse")
include("knitr")
include("stringr")
include("caret")
include("rvest")
include("DT")
include("plyr")
include("dplyr")
purl("linkedin.Rmd", output="part1.r")
source("part1.r")
purl("linkedin2.Rmd", output = "part2.r")
source("part2.r")

```

## Deliverable 1 Edits
Cleaning up my person tibble where I will be removing all rows where a column has a NA. 
```{r}
# Remove rows where NA is present. 
person <- person[!is.na(person$positionLocation),]
person <- person[!is.na(person$ageEstimate),]
person <- person[!is.na(person$genderEstimate),]
person <- person[!is.na(person$companyName),]
person <- person[!is.na(person$country),]
person <- person[!is.na(person$isPremium),]
person <- person[!is.na(person$posTitle),]
person <- person[!is.na(person$positionId),]

#Removing columns I will not need. 
linkedin$companyHasLogo <- NULL
linkedin$hasPicture <- NULL
```


Improving on my graph from deliverable 1. Instead of using points, I will be using a bar graph for better visualization. I have also improved the Y-axis to label with numbers instead of scientific notation. 
```{r}
ggplot(x, aes(name, followerCount)) + geom_col() + 
  scale_y_continuous(name = 'followers', labels = scales::comma) + 
  geom_hline(yintercept = mean(x$followerCount), linetype="dashed", color="red")
```

## Deliverable 2 imporovement
Here, I will be cleaning more of my dataset from deliverable 2. I want to narrow my search just look at their coorpirate positions. These are the one's I have seen a lot of while manually looking through the dataset. 

```{r}
#extract only Managers, Director, Assistant, Engineer, ANalyst, Consultant, Coordinator, and Supervisor
scraped$position <- str_extract(scraped$position, "Manager|Director|Assistant|Engineer|Analyst|Consultant|Coordinator|Supervisor")

#remove rows where position row is NA
scraped <- scraped[!is.na(scraped$position),]

#make position column to factor. 
levels(scraped$position <- as.factor(scraped$position))

#Remove description column
scraped$description <- NULL

#Print first 10 rows. 
head(scraped, n = 10L)
```
# Hypothesis
After looking at my previous dataset and what I have cleaned, I think I will be able to make a model that would be able to **predict how long a person would stay at their job based on various variables**. Here, I will be cleaning up a little more to pursue this question. 
```{r}
#calculate number of positions and calculate avg pay based on positions. 
position_group <- group_by(scraped, position)
avg_pay <- dplyr::summarise(position_group,
  count = n(),
  pay_avg = mean(pay, na.rm = TRUE))

#Creating new tibble where position, number of that position, and average page from scraped data. 
avg_pay_tibble <- tibble(posTitle = as.factor(avg_pay$position), 
                         count = avg_pay$count,
                         avg_pay = avg_pay$pay_avg)

#Making position title column to a factor. 
avg_pay_tibble$posTitle <- as.factor(avg_pay_tibble$posTitle)

#Cleaning linkedin dataset. Grabbing only people where their positions are Manager, Director, Assistant, Engineer, Analyst, Consultant, Coordinator, or Supervisor. 
linkedin$posTitle <- str_extract(linkedin$posTitle, "Manager|Director|Assistant|Engineer|Analyst|Consultant|Coordinator|Supervisor")

#Making position title to a factor 
linkedin$posTitle <- as.factor(linkedin$posTitle)

#Grabbing the position locations where it matches ACT, Adelide, Brisbane, Melbourne, Perth, and Sydney
linkedin$posLocation <- str_extract(linkedin$posLocation, "ACT|Adelaide|Brisbane|Melbourne|Perth|Sydney")

#Doing a join to combine my calculated average pay by position tibble with the original table called linkedin. 
linkedin <- left_join(linkedin, avg_pay_tibble, by= "posTitle")

#Remove all rows where NA exists. 
linkedin <- na.omit(linkedin)

#Remove some columns we don't need. 
linkedin$mbrLocation <- NULL
linkedin$mbrTitle <- NULL

#Print first 10 rows in linkedin.
# head(linkedin, n=10L)
datatable(linkedin, options=list(pageLength=5))
```

# Analysis
For my first analysis, I will be attempting to predict how long a person would stay at their job based on their age, size of company, connection count on Linkedin, follower count on Linkedin, gender, average pay, and by what position. Let's begin. 

```{r}
#Randomly choosing 70% of the data. 
sample_selection <- createDataPartition(linkedin$avgMemberPosDuration, p=0.70, list=FALSE)

#Splitting up 70% to go into our train. and 30% to go into our test. 
train = linkedin[sample_selection, ]
test = linkedin[-sample_selection, ]

# Linear model on average member position duration vs. age, company size, linkedin connections, linkedin followers, gender, average pay, and groups of positions. 
train_model <- lm(avgMemberPosDuration ~ ageEstimate + companyStaffCount + connectionsCount + followersCount + genderEstimate + avg_pay +  factor(posTitle), data = train)
  
summary(train_model)

predictions <- train_model %>% predict(test)

#Let's plot it
ggplot(data = test, aes(x = predictions, y = avgMemberPosDuration)) + geom_jitter() + geom_smooth(method="lm")

R2 <- R2(predictions, test$avgMemberPosDuration)
RMSE <- RMSE(predictions, test$avgMemberPosDuration)
MAE <- MAE(predictions, test$avgMemberPosDuration)

R2
RMSE
MAE
```


Looks like there are some strong indicators that would be helpful to predict how long a person will stay at a company. According to the summary, it says age, linkedin connections count, average pay, assistant positions, coordinator positions, and director positions have significant p-values. Because we see that the Director's position is of significant values, we will need to create a new column to determine if a position is of Director. Then we will include that column into the independent variables to try to make a more accurate estimate of how long a person would stay at their job. 


```{r}
#creates a vector to see if a person's position is a Director type. 
director_bool <- grepl("Director", linkedin$posTitle)

#append this column to our original dataset in linkedin. 
linkedin$director_bool <- director_bool

#Randomly choosing 70% of the data. 
sample_selection <- createDataPartition(linkedin$avgMemberPosDuration, p=0.70, list=FALSE)

#Splitting up 70% to go into our train. and 30% to go into our test. 
train = linkedin[sample_selection, ]
test = linkedin[-sample_selection, ]

#New train models with all the significant variables from pervious model and with our new director boolean variable. 
train_model <- lm(avgMemberPosDuration ~ ageEstimate + connectionsCount + avg_pay + director_bool, data = train)
  
summary(train_model)

predictions <- train_model %>% predict(test)

#Let's plot it
ggplot(data = test, aes(x = predictions, y = avgMemberPosDuration)) + geom_jitter() + geom_smooth(method="lm")

R2 <- R2(predictions, test$avgMemberPosDuration)
RMSE <- RMSE(predictions, test$avgMemberPosDuration)
MAE <- MAE(predictions, test$avgMemberPosDuration)

R2
RMSE
MAE
```


Now that the number of linkedin connections is removed from the independent variables, we could see our final result. All of our variables are now significant with an overall R^2 of 15%. This means that using the age, connections count, and average pay of director position, and for directors, we can estimate about 15% of the time of how long they will stay at their job. 

If we look deeper into the numbers, we can see that for every 1 unit increase in age, the person will stay about an extra 16 days. 
For every 1 unit increase in pay, the person will leave -0.0009 earlier. Since this is in terms of dollars, for every 1000 dollars increase in pay, the person will leave 1 earlier. This is quite interesting as I would have predicted that the more money a person receives, the longer a person stays. This does not seem to be the case though. 
For every 1 unit increase in connectionsCount, the person would stay 27 days less. 
For every 1 unit increase in director being true, the person will stay about 192 days (a little more than half a year) more. 

# Operationalize
I believe that this would be an okay model for HR representatives to look at when they are trying to hire a new director. Depending on how long they want a director to stay at their job, they would need to at least look at their pay, age, and see if they are currently a director. For connections count, this doesn't really make sense. It could be very possible that the director moved jobs various time which would mean that the person meet new people more often. Since these variables only count for 15% of the predictions, we also need to look further into this to see if there are other indicators to predict how long a person would stay being a director. 

In the future, I would like to be able to gather more data on how much directors get paid. Currently, I only have 1 director's pay datapoint. Though this seems to be an good estimate at 175k/year salary, I could actually be way off when directors of all positions and industries are averaged. Also, if there is some way to measure social, emotional intelligence, and leadership, then that would be some data points to collect as it would be a great indicator of how long they might stay at the company. 

Some unintended consequences that might arise from using this data approach to predict how long a director would stay at their position is that once a good model is made, HR representatives could adjust their compensation to make a director stay longer at their company. This could also go the other way as well. For example, if a director is not performing at their peak levels, they would adjust some of the variables to make a director leave their jobs. We would not be entirely sure which way it would sway, but these are just precautionary suggestions. 


